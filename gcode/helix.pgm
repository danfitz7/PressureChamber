G91

; Helix G Code
; Daniel Fitzgerald
; 06-20-2014
; helix conforming to the surface of a sphere to act as a pressure chamber with a large surface area.

DVAR $hFile        
DVAR $cCheck
DVAR $press
DVAR $length
DVAR $lame  

DVAR $COM
DVAR $pressure
DVAR $moveSpeed
DVAR $printSpeedXY
DVAR $printSpeedZ
DVAR $printHeight
DVAR $edgeLength
Primary
FILECLOSE

$COM=9
$pressure=90

; Below, we call several required GCode commands; these commands begin with a G:
G71            ; Standard GCode command for metric units
G76            ; Standard GCode command for time base seconds
G68            
G65 F3000        ; Sets an acceleration speed in mm/s^2
G66 F3000        ; Sets a deceleration speed in mm/s^2

; The “ENABLE” command allows us to enable axes on the printer; this is required for printing
ENABLE X Y A B C D U     ; enables all the axis 


Incremental                ; “Incremental” tells the printer to referring to relative coordinates



; start pressure chamber (spherical Archimedes spiral)

;-----------------------------------------------------------------------
; Begin the script
;-----------------------------------------------------------------------


VELOCITY ON ; interpolate velocities instead of starting and stopping

Call setPress P9 Q90
G90
ABSOLUTE
F1
G1 z-75.000000
G91
Incremental
F0.5
Call togglePress P9
G1 X-0.004771 Y0.024058 z0.000602
G1 X-0.040751 Y-0.040063 z0.001732
G1 X0.075204 Y-0.048692 z0.002759
G1 X0.053305 Y0.107362 z0.003692
G1 X-0.135431 Y0.059290 z0.004538
G1 X-0.070270 Y-0.158735 z0.005307
G1 X0.176172 Y-0.088720 z0.006005
G1 X0.115873 Y0.185775 z0.006638
G1 X-0.184645 Y0.151479 z0.007212
G1 X-0.193432 Y-0.169252 z0.007733
G1 X0.136120 Y-0.237411 z0.008205
G1 X0.276719 Y0.082901 z0.008633
G1 X-0.009719 Y0.302597 z0.009020
G1 X-0.305252 Y0.079450 z0.009371
G1 X-0.175776 Y-0.275707 z0.009689
G1 X0.208398 Y-0.265476 z0.009977
G1 X0.331130 Y0.104040 z0.010237
G1 X0.028003 Y0.354713 z0.010473
G1 X-0.322158 Y0.168912 z0.010685
G1 X-0.292156 Y-0.228613 z0.010877
G1 X0.082892 Y-0.368313 z0.011051
G1 X0.372583 Y-0.090755 z0.011207
G1 X0.255232 Y0.293396 z0.011348
G1 X-0.139465 Y0.368245 z0.011475
G1 X-0.393985 Y0.057814 z0.011590
G1 X-0.248989 Y-0.315884 z0.011693
G1 X0.146066 Y-0.378649 z0.011785
G1 X0.402553 Y-0.073026 z0.011868
G1 X0.277515 Y0.304626 z0.011942
G1 X-0.107206 Y0.400654 z0.012009
G1 X-0.396049 Y0.130996 z0.012068
G1 X-0.331061 Y-0.257332 z0.012121
G1 X0.025682 Y-0.420465 z0.012169
G1 X0.361216 Y-0.220091 z0.012211
G1 X0.389791 Y0.168218 z0.012248
G1 X0.091316 Y0.416023 z0.012281
G1 X-0.283093 Y0.319883 z0.012311
G1 X-0.426600 Y-0.037620 z0.012337
G1 X-0.225902 Y-0.364965 z0.012359
G1 X0.155177 Y-0.401100 z0.012379
G1 X0.413683 Y-0.120275 z0.012396
G1 X0.348226 Y0.254739 z0.012411
G1 X0.012268 Y0.431831 z0.012423
G1 X-0.333098 Y0.275818 z0.012434
G1 X-0.423049 Y-0.091603 z0.012443
G1 X-0.190358 Y-0.389092 z0.012450
G1 X0.186848 Y-0.391051 z0.012455
G1 X0.422569 Y-0.097020 z0.012459
G1 X0.339164 Y0.270243 z0.012461
G1 X-0.000000 Y0.433696 z0.012462
G1 X-0.339164 Y0.270243 z0.012461
G1 X-0.422569 Y-0.097020 z0.012459
G1 X-0.186848 Y-0.391051 z0.012455
G1 X0.190358 Y-0.389092 z0.012450
G1 X0.423049 Y-0.091603 z0.012443
G1 X0.333098 Y0.275818 z0.012434
G1 X-0.012268 Y0.431831 z0.012423
G1 X-0.348226 Y0.254739 z0.012411
G1 X-0.413683 Y-0.120275 z0.012396
G1 X-0.155177 Y-0.401100 z0.012379
G1 X0.225902 Y-0.364965 z0.012359
G1 X0.426600 Y-0.037620 z0.012337
G1 X0.283093 Y0.319883 z0.012311
G1 X-0.091316 Y0.416023 z0.012281
G1 X-0.389791 Y0.168218 z0.012248
G1 X-0.361216 Y-0.220091 z0.012211
G1 X-0.025682 Y-0.420465 z0.012169
G1 X0.331061 Y-0.257332 z0.012121
G1 X0.396049 Y0.130996 z0.012068
G1 X0.107206 Y0.400654 z0.012009
G1 X-0.277515 Y0.304626 z0.011942
G1 X-0.402553 Y-0.073026 z0.011868
G1 X-0.146066 Y-0.378649 z0.011785
G1 X0.248989 Y-0.315884 z0.011693
G1 X0.393985 Y0.057814 z0.011590
G1 X0.139465 Y0.368245 z0.011475
G1 X-0.255232 Y0.293396 z0.011348
G1 X-0.372583 Y-0.090755 z0.011207
G1 X-0.082892 Y-0.368313 z0.011051
G1 X0.292156 Y-0.228613 z0.010877
G1 X0.322158 Y0.168912 z0.010685
G1 X-0.028003 Y0.354713 z0.010473
G1 X-0.331130 Y0.104040 z0.010237
G1 X-0.208398 Y-0.265476 z0.009977
G1 X0.175776 Y-0.275707 z0.009689
G1 X0.305252 Y0.079450 z0.009371
G1 X0.009719 Y0.302597 z0.009020
G1 X-0.276719 Y0.082901 z0.008633
G1 X-0.136120 Y-0.237411 z0.008205
G1 X0.193432 Y-0.169252 z0.007733
G1 X0.184645 Y0.151479 z0.007212
G1 X-0.115873 Y0.185775 z0.006638
G1 X-0.176172 Y-0.088720 z0.006005
G1 X0.070270 Y-0.158735 z0.005307
G1 X0.135431 Y0.059290 z0.004538
G1 X-0.053305 Y0.107362 z0.003692
G1 X-0.075204 Y-0.048692 z0.002759
G1 X0.040751 Y-0.040063 z0.001732
G1 X0.004771 Y0.024058 z0.000602
G1 z1.000000
F1
G1 z2.000000
G1 z10.000000
Call togglePress P9
G1 Y-3.500000
G1 X3.500000 Y1.000000

VELOCITY OFF

M2



;----------------------------------------------------------
; END OF CODE - Function definitions below
;----------------------------------------------------------
DFS setPress        
         
	$strtask1 = DBLTOSTR( $P, 0 )            
	$strtask1 = "COM" + $strtask1
	$hFile = FILEOPEN $strtask1, 2
	COMMINIT $hFile, "baud=115200 parity=N data=8 stop=1"
	COMMSETTIMEOUT $hFile, -1, -1, 1000
                             
	$press = $Q * 10.0                             
	$strtask2 = DBLTOSTR( $press , 0 )  
      
      
	$length = STRLEN( $strtask2 )      
	WHILE $length < 4.0
		$strtask2 = "0" + $strtask2    
		$length = STRLEN( $strtask2 ) 
	ENDWHILE

	$strtask2 = "08PS  " + $strtask2
                                    
	$cCheck = 0.00     
	$lame = STRTOASCII ($strtask2, 0)
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 1) 
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 2) 
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 3) 
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 4)
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 5) 
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 6) 
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 7) 
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 8) 
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 9)  
	$cCheck = $cCheck - $lame
                        
	WHILE( $cCheck) < 0
		$cCheck = $cCheck + 256
	ENDWHILE                        

	$strtask3 = makestring "{#H}" $cCheck   
	$strtask3 = STRUPR( $strtask3 )
	$strtask2 = "" + $strtask2 + $strtask3 + ""
            
	FILEWRITE $hFile ""
	FILEWRITE $hFile $strtask2
	FILEWRITE $hFile ""

	FILECLOSE $hFile

ENDDFS

DFS togglePress        
         
	$strtask1 = DBLTOSTR( $P, 0 )            
	$strtask1 = "COM" + $strtask1
	$hFile = FILEOPEN $strtask1, 2
	COMMINIT $hFile, "baud=115200 parity=N data=8 stop=1"
	COMMSETTIMEOUT $hFile, -1, -1, 1000

	$strtask2 = "04DI  "
                                    
	$cCheck = 0.00     
	$lame = STRTOASCII ($strtask2, 0)
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 1) 
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 2) 
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 3) 
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 4)
	$cCheck = $cCheck - $lame
	$lame = STRTOASCII( $strtask2, 5) 
	$cCheck = $cCheck - $lame
                        
	WHILE( $cCheck) < 0
		$cCheck = $cCheck + 256
	ENDWHILE                        

	$strtask3 = makestring "{#H}" $cCheck   
	$strtask3 = STRUPR( $strtask3 )
	$strtask2 = "" + $strtask2 + $strtask3 + ""
                  
	FILEWRITE $hFile ""
	FILEWRITE $hFile $strtask2
	FILEWRITE $hFile ""

	FILECLOSE $hFile

ENDDFS  
;----------------------------------------------------------
;----------------------------------------------------------
;----------------------------------------------------------

